WITH @@roots
RETURN {
  "allRoot2s": (
    FOR v_root21
    IN @@root2s
    RETURN {
      "name": v_root21.`name`,
      "roots": (
        FOR v_root1
        IN OUTBOUND v_root21 @@root2s_roots
        FILTER v_root1._key != null
        SORT (v_root1.`name`)
        RETURN {
          "grandchildren": v_root1.`children`[*].`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var1)) == @var2) RETURN {
            "name": CURRENT.`name`,
            "root": {
              "name": v_root1.`name`
            }
          }],
          @var3: {
            "count": FIRST(
              FOR v_item1
              IN v_root1.`children`[*].`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var4)) == @var5)]
              COLLECT WITH COUNT INTO v_count1
              RETURN v_count1
            )
          },
          "extensionGrandchildren": v_root1.`children`[*].`extension`.`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var6)) == @var7) RETURN {
            "root": {
              "name": v_root1.`name`
            }
          }],
          @var8: {
            "count": FIRST(
              FOR v_item2
              IN v_root1.`children`[*].`extension`.`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var9)) == @var10)]
              COLLECT WITH COUNT INTO v_count2
              RETURN v_count2
            )
          }
        }
      ),
      "rootGrandchildren": (
        FOR v_root2, v_edge1, v_path1 IN @var11..@var12 OUTBOUND v_root21 @@root2s_roots
        FILTER v_root2._key != null
        FOR v_item3 IN v_root2.`children`[*].`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var13)) == @var14) RETURN {
          value: {
            "name": CURRENT.`name`,
            "root": {
              "name": v_root2.`name`
            }
          },
          sortValues: [
            CURRENT.`name`
          ]
        }]
        SORT v_item3.sortValues[0]
        RETURN v_item3.value
      ),
      @var15: {
        "count": FIRST(
          FOR v_item4
          IN (
            FOR v_root3, v_edge2, v_path2 IN @var16..@var17 OUTBOUND v_root21 @@root2s_roots
            FILTER v_root3._key != null
            FOR v_item5 IN v_root3.`children`[*].`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var18)) == @var19)]
            RETURN v_item5
          )
          COLLECT WITH COUNT INTO v_count3
          RETURN v_count3
        )
      },
      "rootExtensionGrandchildren": (
        FOR v_root4, v_edge3, v_path3 IN @var20..@var21 OUTBOUND v_root21 @@root2s_roots
        FILTER v_root4._key != null
        FOR v_item6 IN v_root4.`children`[*].`extension`.`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var22)) == @var23) RETURN {
          value: {
            "name": CURRENT.`name`,
            "root": {
              "name": v_root4.`name`
            }
          },
          sortValues: [
            CURRENT.`name`
          ]
        }]
        SORT v_item6.sortValues[0]
        RETURN v_item6.value
      ),
      @var24: {
        "count": FIRST(
          FOR v_item7
          IN (
            FOR v_root5, v_edge4, v_path4 IN @var25..@var26 OUTBOUND v_root21 @@root2s_roots
            FILTER v_root5._key != null
            FOR v_item8 IN v_root5.`children`[*].`extension`.`children`[*][** FILTER (RIGHT(CURRENT.`name`, LENGTH(@var27)) == @var28)]
            RETURN v_item8
          )
          COLLECT WITH COUNT INTO v_count4
          RETURN v_count4
        )
      }
    }
  )
}

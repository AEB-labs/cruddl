WITH @@roots
RETURN {
  "allRoot2s": (
    FOR v_root21
    IN @@root2s
    RETURN {
      "name": v_root21.`name`,
      "roots": (
        FOR v_root1
        IN OUTBOUND v_root21 @@root2s_roots
        FILTER v_root1._key != null
        SORT (v_root1.`name`)
        RETURN {
          "grandchildren": v_root1.`children`[*].`children`[*][** RETURN {
            "root": {
              "name": v_root1.`name`
            }
          }],
          "extensionGrandchildren": v_root1.`children`[*].`extension`.`children`[*][** RETURN {
            "root": {
              "name": v_root1.`name`
            }
          }]
        }
      ),
      "rootGrandchildren": (
        FOR v_root2, v_edge1, v_path1 IN @var1..@var2 OUTBOUND v_root21 @@root2s_roots
        FILTER v_root2._key != null
        FOR v_item1 IN v_root2.`children`[*].`children`[*][** RETURN {
          value: {
            "name": CURRENT.`name`,
            "root": {
              "name": v_root2.`name`
            }
          },
          sortValues: [
            CURRENT.`name`
          ]
        }]
        SORT v_item1.sortValues[0]
        RETURN v_item1.value
      ),
      "rootExtensionGrandchildren": (
        FOR v_root3, v_edge2, v_path2 IN @var3..@var4 OUTBOUND v_root21 @@root2s_roots
        FILTER v_root3._key != null
        FOR v_item2 IN v_root3.`children`[*].`extension`.`children`[*][** RETURN {
          value: {
            "name": CURRENT.`name`,
            "root": {
              "name": v_root3.`name`
            }
          },
          sortValues: [
            CURRENT.`name`
          ]
        }]
        SORT v_item2.sortValues[0]
        RETURN v_item2.value
      )
    }
  )
}

// Peak memory usage: 393216 bytes

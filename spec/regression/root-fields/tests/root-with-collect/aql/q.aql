WITH @@roots
RETURN {
  "allRoot2s": (
    FOR v_root21
    IN @@root2s
    RETURN {
      "name": v_root21.`name`,
      "roots": (
        FOR v_root1
        IN OUTBOUND v_root21 @@root2s_roots
        FILTER v_root1 != null
        SORT (v_root1.`name`)
        RETURN {
          "grandchildren": (
            FOR v_grandchild1
            IN v_root1.`children`[*].`children`[*][**]
            RETURN {
              "root": {
                "name": v_root1.`name`
              }
            }
          ),
          "extensionGrandchildren": (
            FOR v_extensionGrandchild1
            IN v_root1.`children`[*].`extension`.`children`[*][**]
            RETURN {
              "root": {
                "name": v_root1.`name`
              }
            }
          )
        }
      ),
      "rootGrandchildren": (
        FOR v_grandchild2
        IN (
          FOR v_node1, v_edge1, v_path1 IN @var1..@var2 OUTBOUND v_root21 @@root2s_roots
          FILTER v_node1 != null
          RETURN (
            FOR v_entity1 IN v_node1.`children`[*].`children`[*][**]
            RETURN { obj: v_entity1, root: v_node1 }
          )
        )[**]
        SORT (v_grandchild2.`obj`.`name`)
        RETURN {
          "name": v_grandchild2.`obj`.`name`,
          "root": {
            "name": v_grandchild2.`root`.`name`
          }
        }
      ),
      "rootExtensionGrandchildren": (
        FOR v_extensionGrandchild2
        IN (
          FOR v_node2, v_edge2, v_path2 IN @var3..@var4 OUTBOUND v_root21 @@root2s_roots
          FILTER v_node2 != null
          RETURN (
            FOR v_entity2 IN v_node2.`children`[*].`extension`.`children`[*][**]
            RETURN { obj: v_entity2, root: v_node2 }
          )
        )[**]
        SORT (v_extensionGrandchild2.`obj`.`name`)
        RETURN {
          "name": v_extensionGrandchild2.`obj`.`name`,
          "root": {
            "name": v_extensionGrandchild2.`root`.`name`
          }
        }
      )
    }
  )
}

// Peak memory usage: 2457600 bytes

WITH @@deliveries
LET v_shipment1 = FIRST((
  FOR v_shipment2
  IN @@shipments
  FILTER (v_shipment2.`shipmentNumber` == @var1)
  LIMIT @var2
  RETURN v_shipment2
))
RETURN {
  "Shipment": (IS_NULL(v_shipment1) ? null : {
    "allItems": (
      FOR v_root1, v_edge1, v_path1 IN @var3..@var4 OUTBOUND v_shipment1 @@shipments_deliveries
      FILTER v_root1._key != null
      FOR v_item1 IN v_root1.`deliveryContents`[*].`items`[*][** FILTER (RIGHT(CURRENT.`itemNumber`, LENGTH(@var5)) == @var6) RETURN {
        value: {
          "itemNumber": CURRENT.`itemNumber`
        },
        sortValues: [
          CURRENT.`itemNumber`
        ]
      }]
      SORT v_item1.sortValues[0]
      LIMIT @var7, @var8
      RETURN v_item1.value
    ),
    "allDeliveryContents": (
      FOR v_root2, v_edge2, v_path2 IN @var9..@var10 OUTBOUND v_shipment1 @@shipments_deliveries
      FILTER v_root2._key != null
      FOR v_item2 IN v_root2.`deliveryContents`[* FILTER (RIGHT(CURRENT.`deliveryContentNumber`, LENGTH(@var11)) == @var12) RETURN {
        value: {
          "deliveryContentNumber": CURRENT.`deliveryContentNumber`
        },
        sortValues: [
          CURRENT.`deliveryContentNumber`
        ]
      }]
      SORT v_item2.sortValues[0]
      LIMIT @var13, @var14
      RETURN v_item2.value
    )
  })
}

// Peak memory usage: 262144 bytes

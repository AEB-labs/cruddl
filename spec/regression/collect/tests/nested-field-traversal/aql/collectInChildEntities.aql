LET v_delivery1 = FIRST((
  FOR v_delivery2
  IN @@deliveries
  FILTER (v_delivery2.`deliveryNumber` == @var1)
  LIMIT @var2
  RETURN v_delivery2
))
RETURN {
  "Delivery": (IS_NULL(v_delivery1) ? null : {
    "deliveryContents": (
      FOR v_deliveryContent1
      IN (IS_LIST(v_delivery1.`deliveryContents`) ? v_delivery1.`deliveryContents` : [])
      RETURN {
        "items": (
          FOR v_deliveryItem1
          IN (IS_LIST(v_deliveryContent1.`items`) ? v_deliveryContent1.`items` : [])
          RETURN {
            "subSubItems": (
              FOR v_deliveryItem2
              IN v_deliveryItem1.`subItems`[*].`subItems`[*][**]
              SORT (v_deliveryItem2.`itemNumber`)  DESC
              RETURN {
                "itemNumber": v_deliveryItem2.`itemNumber`
              }
            )
          }
        )
      }
    )
  })
}

// Peak memory usage: 229376 bytes

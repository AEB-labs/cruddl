WITH @@handlingUnits
LET v_delivery1 = FIRST((
  FOR v_delivery2
  IN @@deliveries
  FILTER (v_delivery2.`deliveryNumber` == @var1)
  LIMIT @var2
  RETURN v_delivery2
))
RETURN {
  "Delivery": (IS_NULL(v_delivery1) ? null : {
    "allWarehouseSlots": (
      FOR v_warehouseSlot1
      IN (
        FOR v_item1
        IN (
          FOR v_node1, v_edge1, v_path1 IN @var3..@var4 OUTBOUND v_delivery1 @@deliveries_handlingUnits
          FILTER v_node1 != null
          RETURN v_node1.`warehouseSlot`
        )
        FILTER v_item1 != null
        COLLECT v_distinct1 = v_item1
        RETURN v_distinct1
      )
      SORT (v_warehouseSlot1.`warehouse`) , (v_warehouseSlot1.`level`)
      RETURN {
        "warehouse": v_warehouseSlot1.`warehouse`,
        "level": v_warehouseSlot1.`level`
      }
    )
  })
}

// Peak memory usage: 196608 bytes

WITH @@files
RETURN (
  FOR v_item1
  IN [
    FIRST(
      LET v_entity1 = DOCUMENT(@@files, @var1)
      RETURN ((v_entity1.`accessGroup` IN @var2) ? v_entity1 : null)
    )._key
  ]
  FILTER (v_item1 > NULL)
  RETURN v_item1
)

// Peak memory usage: 0 bytes

// ----------------------------------------------------------------

WITH @@files
RETURN (FIRST(
  FOR v_item1
  IN (
    FOR v_file1
    IN @v_ids1
    FILTER !((DOCUMENT(@@files, v_file1).`accessGroup` IN @var1))
    RETURN v_file1
  )
  COLLECT WITH COUNT INTO v_count1
  RETURN v_count1
) == 0)

// Peak memory usage: 32768 bytes

// ----------------------------------------------------------------

WITH @@files
RETURN (
  FOR v_File1
  IN (
    FOR v_file1
    IN @v_ids1
    REMOVE v_file1
    IN @@files
    RETURN OLD
  )
  RETURN {
    "name": v_File1.`name`
  }
)

// Peak memory usage: 32768 bytes

// ----------------------------------------------------------------

WITH @@files
RETURN {
  "deleteFiles": @v_deleteFiles1
}

// Peak memory usage: 0 bytes

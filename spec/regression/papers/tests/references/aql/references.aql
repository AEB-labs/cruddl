RETURN {
  "allPapers": (
    FOR v_paper1
    IN @@papers
    SORT (v_paper1.`title`)
    RETURN {
      "title": v_paper1.`title`,
      "literatureReferences": (
        FOR v_literatureReference1
        IN (IS_LIST(v_paper1.`literatureReferences`) ? v_paper1.`literatureReferences` : [])
        LET v_paper2 = (IS_NULL(v_literatureReference1.`paper`) ? null : FIRST((
          FOR v_paper3
          IN @@papers
          FILTER ((v_paper3.`key` > NULL) && (v_paper3.`key` == v_literatureReference1.`paper`))
          LIMIT @var1
          RETURN v_paper3
        )))
        RETURN {
          "paper": (IS_NULL(v_paper2) ? null : {
            "title": v_paper2.`title`,
            "publishDate": v_paper2.`publishDate`,
            "isPublished": v_paper2.`isPublished`,
            "tags": (IS_LIST(v_paper2.`tags`) ? v_paper2.`tags` : [])
          }),
          "authors": (IS_LIST(v_literatureReference1.`authors`) ? v_literatureReference1.`authors` : []),
          "pages": (IS_NULL(v_literatureReference1.`pages`) ? null : {
            "startPage": v_literatureReference1.`pages`.`startPage`,
            "endPage": v_literatureReference1.`pages`.`endPage`
          })
        }
      ),
      "tags": (IS_LIST(v_paper1.`tags`) ? v_paper1.`tags` : [])
    }
  )
}

// Peak memory usage: 98304 bytes

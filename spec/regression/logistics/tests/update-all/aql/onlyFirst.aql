RETURN (
  FOR v_currentEntity1
  IN (
    FOR v_delivery1
    IN @@deliveries
    FILTER ((v_delivery1.`deliveryNumber` == @var1) || (v_delivery1.`deliveryNumber` == @var2))
    SORT (v_delivery1.`deliveryNumber`)
    LIMIT @var3
    RETURN v_delivery1
  )
  UPDATE v_currentEntity1
  WITH {
    "consignee": @var4,
    "updatedAt": @var5
  }
  IN @@deliveries
  OPTIONS { mergeObjects: false }
  RETURN NEW._key
)

// --------------------------------

WITH @@deliveries
RETURN (
  FOR v_delivery1
  IN (
    FOR v_id1
    IN @v_updatedIds1
    RETURN DOCUMENT(@@deliveries, v_id1)
  )
  RETURN {
    "deliveryNumber": v_delivery1.`deliveryNumber`,
    "consignee": (IS_NULL(v_delivery1.`consignee`) ? null : {
      "city": v_delivery1.`consignee`.`city`
    })
  }
)

// --------------------------------

WITH @@deliveries
RETURN {
  "updateAllDeliveries": @v_updateAllDeliveries1
}

RETURN {
  "allDeliveries": (
    FOR v_delivery1
    IN @@deliveries
    FILTER (FIRST(
      FOR v_item1
      IN (
        FOR v_items1
        IN (IS_LIST(v_delivery1.`items`) ? v_delivery1.`items` : [])
        RETURN v_items1
      )
      COLLECT WITH COUNT INTO v_count1
      RETURN v_count1
    ) == @var1)
    RETURN {
      "deliveryNumber": v_delivery1.`deliveryNumber`,
      @var2: {
        "count": FIRST(
          FOR v_item2
          IN (IS_LIST(v_delivery1.`items`) ? v_delivery1.`items` : [])
          COLLECT WITH COUNT INTO v_count2
          RETURN v_count2
        )
      }
    }
  )
}

RETURN (
  FOR v_currentEntity1
  IN (
    FOR v_delivery1
    IN @@deliveries
    FILTER (v_delivery1._key == @var1)
    LIMIT @var2
    RETURN v_delivery1
  )
  UPDATE v_currentEntity1
  WITH {
    "serialNumbers": @var3,
    "consignee": @var4,
    "contentInfo": @var5,
    "dgInfo": MERGE((IS_OBJECT(v_currentEntity1.`dgInfo`) ? v_currentEntity1.`dgInfo` : {}), {
      "unNumber": @var6,
      "flashpoint": @var7,
      "notices": @var8
    }),
    "destinationCountryISOCode": @var9,
    "items": UNION((IS_LIST(v_currentEntity1.`items`) ? v_currentEntity1.`items` : []), @var10),
    "updatedAt": @var11
  }
  IN @@deliveries
  OPTIONS { mergeObjects: false }
  RETURN NEW._key
)

// Peak memory usage: 98304 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN DOCUMENT(@@handlingUnits, @var1)

// Peak memory usage: 0 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN DOCUMENT(@@handlingUnits, @var1)

// Peak memory usage: 0 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_to1 IN @var1
  FOR v_edge1 IN @@deliveries_handlingUnits
  FILTER v_edge1._to == v_to1
  REMOVE v_edge1 IN @@deliveries_handlingUnits
)

// Peak memory usage: 32768 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_edge1
  IN [ {_from: CONCAT(@var1, FIRST(@v_updatedIds1)), _to: @var2}, {_from: CONCAT(@var3, FIRST(@v_updatedIds1)), _to: @var4} ]
  UPSERT { _from: v_edge1._from, _to: v_edge1._to }
  INSERT v_edge1
  UPDATE {}
  IN @@deliveries_handlingUnits
)

// Peak memory usage: 65536 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_entity1 IN @var1
  INSERT v_entity1 IN @@handlingUnits
  RETURN NEW._key
)

// Peak memory usage: 32768 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_edge1
  IN [ {_from: CONCAT(@var1, FIRST(@v_updatedIds1)), _to: CONCAT(@var2, (@v_newEntityIds1)[@var3])} ]
  UPSERT { _from: v_edge1._from, _to: v_edge1._to }
  INSERT v_edge1
  UPDATE {}
  IN @@deliveries_handlingUnits
)

// Peak memory usage: 65536 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_currentEntity1
  IN (
    FOR v_delivery1
    IN @@deliveries
    FILTER (v_delivery1._key == @var1)
    LIMIT @var2
    RETURN v_delivery1
  )
  UPDATE v_currentEntity1
  WITH {
    "serialNumbers": @var3,
    "consignee": @var4,
    "contentInfo": @var5,
    "dgInfo": MERGE((IS_OBJECT(v_currentEntity1.`dgInfo`) ? v_currentEntity1.`dgInfo` : {}), {
      "unNumber": @var6,
      "flashpoint": @var7,
      "notices": @var8
    }),
    "destinationCountryISOCode": @var9,
    "items": UNION((IS_LIST(v_currentEntity1.`items`) ? v_currentEntity1.`items` : []), @var10),
    "updatedAt": @var11
  }
  IN @@deliveries
  OPTIONS { mergeObjects: false }
  RETURN NEW._key
)

// Peak memory usage: 98304 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN DOCUMENT(@@handlingUnits, @var1)

// Peak memory usage: 0 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN DOCUMENT(@@handlingUnits, @var1)

// Peak memory usage: 0 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_to1 IN @var1
  FOR v_edge1 IN @@deliveries_handlingUnits
  FILTER v_edge1._to == v_to1
  REMOVE v_edge1 IN @@deliveries_handlingUnits
)

// Peak memory usage: 32768 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_edge1
  IN [ {_from: CONCAT(@var1, FIRST(@v_updatedIds1)), _to: @var2}, {_from: CONCAT(@var3, FIRST(@v_updatedIds1)), _to: @var4} ]
  UPSERT { _from: v_edge1._from, _to: v_edge1._to }
  INSERT v_edge1
  UPDATE {}
  IN @@deliveries_handlingUnits
)

// Peak memory usage: 98304 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_entity1 IN @var1
  INSERT v_entity1 IN @@handlingUnits
  RETURN NEW._key
)

// Peak memory usage: 32768 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits
RETURN (
  FOR v_edge1
  IN [ {_from: CONCAT(@var1, FIRST(@v_updatedIds1)), _to: CONCAT(@var2, (@v_newEntityIds1)[@var3])} ]
  UPSERT { _from: v_edge1._from, _to: v_edge1._to }
  INSERT v_edge1
  UPDATE {}
  IN @@deliveries_handlingUnits
)

// Peak memory usage: 65536 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits, @@deliveries
RETURN (
  FOR v_delivery1
  IN [
    DOCUMENT(@@deliveries, @var1),
    DOCUMENT(@@deliveries, @var2)
  ]
  LET v_country1 = (IS_NULL(v_delivery1.`consignee`.`country`) ? null : FIRST((
    FOR v_country2
    IN @@countries
    FILTER ((v_country2.`isoCode` > NULL) && (v_country2.`isoCode` == v_delivery1.`consignee`.`country`))
    LIMIT @var3
    RETURN v_country2
  )))
  LET v_country3 = (IS_NULL(v_delivery1.`destinationCountryISOCode`) ? null : FIRST((
    FOR v_destinationCountry1
    IN @@countries
    FILTER ((v_destinationCountry1.`isoCode` > NULL) && (v_destinationCountry1.`isoCode` == v_delivery1.`destinationCountryISOCode`))
    LIMIT @var4
    RETURN v_destinationCountry1
  )))
  RETURN {
    "deliveryNumber": v_delivery1.`deliveryNumber`,
    "consignee": (IS_NULL(v_delivery1.`consignee`) ? null : {
      "city": v_delivery1.`consignee`.`city`,
      "country": (IS_NULL(v_country1) ? null : {
        "isoCode": v_country1.`isoCode`,
        "description": v_country1.`description`[* RETURN {
          "languageIsoCode": CURRENT.`languageIsoCode`,
          "translation": CURRENT.`translation`
        }]
      }),
      "street": v_delivery1.`consignee`.`street`
    }),
    "contentInfo": v_delivery1.`contentInfo`[* RETURN {
      "translation": CURRENT.`translation`,
      "languageIsoCode": CURRENT.`languageIsoCode`
    }],
    "destinationCountry": (IS_NULL(v_country3) ? null : {
      "isoCode": v_country3.`isoCode`
    }),
    "dgInfo": {
      "flashpoint": v_delivery1.`dgInfo`.`flashpoint`,
      "unNumber": v_delivery1.`dgInfo`.`unNumber`,
      "notices": v_delivery1.`dgInfo`.`notices`[*]
    },
    "serialNumbers": v_delivery1.`serialNumbers`[*],
    "items": v_delivery1.`items`[* RETURN {
      "itemNumber": CURRENT.`itemNumber`
    }],
    "handlingUnits": (
      FOR v_handlingUnit1
      IN OUTBOUND v_delivery1 @@deliveries_handlingUnits
      FILTER v_handlingUnit1._key != null
      SORT (v_handlingUnit1.`huNumber`)
      RETURN {
        "huNumber": v_handlingUnit1.`huNumber`
      }
    )
  }
)

// Peak memory usage: 163840 bytes

// ----------------------------------------------------------------

WITH @@handlingUnits, @@deliveries
RETURN {
  "updateDeliveries": @v_updateDeliveries1
}

// Peak memory usage: 0 bytes

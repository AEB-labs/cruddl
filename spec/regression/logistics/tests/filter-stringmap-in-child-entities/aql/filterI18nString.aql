LET v_delivery1 = FIRST((
  FOR v_delivery2
  IN @@deliveries
  FILTER (v_delivery2.`deliveryNumber` == @var1)
  LIMIT @var2
  RETURN v_delivery2
))
RETURN {
  "Delivery": (IS_NULL(v_delivery1) ? null : {
    "items": (
      FOR v_deliveryItem1
      IN (IS_LIST(v_delivery1.`items`) ? v_delivery1.`items` : [])
      FILTER (FIRST(
        FOR v_item1
        IN (
          FOR v_description1
          IN (
            LET v_object1 = v_deliveryItem1.`description`
            FOR v_key1 IN IS_DOCUMENT(v_object1) ? ATTRIBUTES(v_object1) : []
            RETURN [ v_key1, v_object1[v_key1] ]
          )
          FILTER ((v_description1)[@var3] == @var4)
          RETURN v_description1
        )
        COLLECT WITH COUNT INTO v_count1
        RETURN v_count1
      ) > @var5)
      RETURN {
        "itemNumber": v_deliveryItem1.`itemNumber`
      }
    )
  })
}

// Peak memory usage: 65536 bytes

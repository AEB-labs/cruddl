# Architecture

This document lists and explains the main components in cruddl.

## Overview

cruddl defines a GraphQL-based schema definition language (SDL) and provides an executable GraphQL schema to query and
mutate data in a database.

-   **Project:** A collection of GraphQL and JSON/YAML source files that define the schema
-   **Model:** A feature-rich graph of objects describing a schema, generated by parsing the project sources
-   **Model config:** A plain JSON structure, defined by interfaces, serving as the input for a Model
-   **GraphQL schema:** The executable GraphQLSchema instance, generated from a model
-   **Query Tree:** An abstract in-memory representation of an operation (with queries and mutations) to be processed by
    the database
-   **Database adapter:** Adapter to process a query tree, e.g. by converting it to a database-specific query language

## Schema Generation

Creating a GraphQL schema involves several steps:

-   Source validation (e.g. JSON/YAML syntax, JSON schema, GraphQL syntax, general GraphQL rules)
-   Parsing (text to JSON, YAML, GraphQL)
-   AST validation (based on the GraphQL AST). There are only a few of these rules left.
-   Model config generation (traversing the GraphQL AST, also emitting some validation messages)
-   Model generation (config objects to "real" model instances, also doing validation)
-   Schema generation (based on the model, not reusing any of the original AST. Already attaches implementations of the
    query and mutation fields as resolvers to the schema, using a database adapter)

## Execution

The schema generation step provides GraphQL resolvers to the root fields that process a whole operation on one step. It
passes through these steps:

-   Parsing (into the AST, done by the GraphQL engine)
-   Query distillation (simplifies the GraphQL AST by normalizing aliases and evaluating @include and @skip)
-   Query tree generation (using special QueryTree-based resolvers on the fields in the schema)
-   In the Database adapter: Conversion to target language such as AQL and execution
